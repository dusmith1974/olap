<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <title>Timing</title>
  <link rel="stylesheet" type="text/css" href="../css/timing.css">

  <script type="text/javascript">
    function WebSocketTest() {
      if ("WebSocket" in window) {
        var ws = new WebSocket("ws://localhost:9980/ws");
        ws.onopen = function () {
          ws.send("START RACE");
        };
        ws.onmessage = function (evt) {
          var msg = evt.data;
          document.getElementById("lastMessage").innerHTML = msg;
          document.getElementById("status").innerHTML = "Socket Open";

          for (var n = 1, r = document.querySelector("tbody>tr"), p = r.parentNode; n--; p.appendChild(r.cloneNode(true)));
          var table = document.getElementById("messages");

          if (typeof WebSocketTest.counter == 'undefined')
            WebSocketTest.counter = 0;

          table.rows[table.rows.length - 1].cells[0].innerHTML = ++WebSocketTest.counter;
          table.rows[table.rows.length - 1].cells[1].innerHTML = msg;

          if (table.rows.length >= 25)
            table.deleteRow(1);

          var rows = table.getElementsByTagName("tr");
          table.focus();
          table.parentNode.scrollTop = rows[table.rows.length - 1].offsetTop - rows[0].offsetHeight;
        };

        ws.onclose = function () {
          document.getElementById("status").innerHTML = "Socket Closed";
          //alert("ws close.");
        };

        window.onbeforeunload = function () {
          ws.onclose = function () { };
          ws.close();
        };
      }
      else {
        alert("This browser does not support WebSockets.");
      }
    }
  </script>
</head>
<body>
  <h3>Live Timing</h3>
  <p><a href="javascript:WebSocketTest()">Start Race</a></p>
  <p id="status">Socket Closed</p>
  <p id="lastMessage">...Last Message...</p>
  <div class="fixed-table-container">
    <div class="header-background"> </div>
    <div class="fixed-table-container-inner">
      <table id="messages" cellspacing="0">
        <!--<caption>Live Timing</caption>-->
        <thead>
          <tr>
            <th>
              <div class="th-inner">No</div>
            </th>
            <th>
              <div class="th-inner">Message</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>0</td>
            <td>Pitlane Open</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <h1>Australia GP</h1>
  <h2>Timing Page</h2>
  <p>Replay of the Australian GP</p>
  <p>Top level navigation links here</p>
  <h3>Drivers</h3>
  <ul>
    <li>HAM</li>
    <li>ALO</li>
    <li>BUT</li>
  </ul>
  <h3>Teams</h3>
  <ol>
    <li><a href="mclaren.html" target="_blank">McLaren</a></li>
    <li>Ferrari</li>
    <li>Mercedes</li>
  </ol>
</body>
</html>
